---
import PythonPlayground from './PythonPlayground.astro';

interface LessonExercise {
  title: string;
  prompt: string;
  starterCode: string;
  solutionCode?: string;
  expectedOutput?: string;
  hints?: string[];
  tags?: string[];
}

interface Props {
  item: LessonExercise;
  index: number;
}

const { item, index } = Astro.props;
---

<article class="exercise-card try-it" aria-labelledby={`try-it-${index}`}>
  <p class="exercise-eyebrow">Try It {index}</p>
  <h3 id={`try-it-${index}`}>{item.title}</h3>
  <p>{item.prompt}</p>

  {item.tags && item.tags.length > 0 && (
    <ul class="tag-list" aria-label="Tags">
      {item.tags.map((tag) => (
        <li>{tag}</li>
      ))}
    </ul>
  )}

  <PythonPlayground code={item.starterCode} label="Starter code" outputLabel="Your output" />

  {item.expectedOutput && (
    <div class="result-block">
      <h4>Expected output</h4>
      <pre><code>{item.expectedOutput}</code></pre>
    </div>
  )}

  {item.hints && item.hints.length > 0 && (
    <details class="exercise-details">
      <summary>Hints</summary>
      <ul>
        {item.hints.map((hint) => (
          <li>{hint}</li>
        ))}
      </ul>
    </details>
  )}

  {item.solutionCode && (
    <details class="exercise-details">
      <summary>Show one possible solution</summary>
      <PythonPlayground code={item.solutionCode} label="Solution code" outputLabel="Solution output" />
    </details>
  )}
</article>

<style>
  .exercise-card {
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--bg-elevated);
    padding: var(--space-md);
    margin-top: var(--space-md);
  }

  .try-it {
    border-left: 4px solid var(--accent-1);
  }

  .exercise-eyebrow {
    margin: 0 0 var(--space-xs);
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--ink-muted);
    font-weight: 600;
  }

  .result-block {
    margin-top: var(--space-md);
  }

  .result-block h4 {
    margin-bottom: var(--space-xs);
    font-size: 0.95rem;
  }

  .result-block pre {
    margin: 0;
    padding: var(--space-sm);
    background: color-mix(in srgb, var(--accent-1) 8%, var(--bg-elevated));
  }

  .exercise-details {
    margin-top: var(--space-sm);
    border: 1px dashed var(--line);
    border-radius: var(--radius-sm);
    padding: var(--space-sm);
    background: color-mix(in srgb, var(--accent-1) 6%, var(--bg-elevated));
  }

  .exercise-details summary {
    cursor: pointer;
    font-weight: 600;
  }

  .exercise-details ul {
    margin: var(--space-sm) 0 0;
  }
</style>
