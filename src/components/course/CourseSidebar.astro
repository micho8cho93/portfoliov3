---
import { withBase } from '../../utils/withBase';
import { lessonRoute } from '../../lib/routes';

interface LessonItem {
  slug: string;
  title: string;
  order: number;
}

interface ModuleItem {
  moduleId: string;
  moduleTitle: string;
  lessons: LessonItem[];
}

interface Props {
  courseSlug: string;
  modules: ModuleItem[];
  currentLessonSlug?: string;
}

const { courseSlug, modules, currentLessonSlug } = Astro.props;
---

<aside class="course-sidebar" aria-label="Course navigation">
  <details open>
    <summary>Course Modules</summary>
    {modules.map((module) => (
      <section>
        <h2>{module.moduleTitle}</h2>
        <ol>
          {module.lessons.map((lesson) => {
            const isActive = lesson.slug === currentLessonSlug;
            return (
              <li>
                <a
                  href={withBase(lessonRoute(courseSlug, lesson.slug))}
                  aria-current={isActive ? 'page' : undefined}
                  class={isActive ? 'active' : undefined}
                >
                  {lesson.title}
                </a>
              </li>
            );
          })}
        </ol>
      </section>
    ))}
  </details>
</aside>

<style>
  .course-sidebar {
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--bg-elevated);
    padding: var(--space-md);
    position: sticky;
    top: var(--space-md);
  }

  .course-sidebar summary {
    cursor: pointer;
    font-weight: 600;
    margin-bottom: var(--space-sm);
    list-style: none;
    color: var(--text);
  }

  .course-sidebar summary::-webkit-details-marker {
    display: none;
  }

  .course-sidebar summary::before {
    content: 'â–¾';
    color: var(--text);
    display: inline-block;
    margin-right: 0.4rem;
    transform-origin: 50% 55%;
    transition: transform 0.15s ease;
  }

  .course-sidebar details:not([open]) summary::before {
    transform: rotate(-90deg);
  }

  .course-sidebar h2 {
    font-size: 1rem;
    margin-bottom: var(--space-xs);
  }

  .course-sidebar section + section {
    margin-top: var(--space-md);
  }

  .course-sidebar ol {
    margin: 0;
    padding-left: 1.2rem;
  }

  a.active {
    color: var(--accent-1);
    font-weight: 700;
    text-decoration: underline;
  }

  @media (min-width: 56rem) {
    details {
      display: block;
    }
  }
</style>
