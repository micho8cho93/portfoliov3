---
import { withBase } from "../../utils/withBase";
import { course as courseRoute } from "../../lib/routes";
import Layout from '../../components/Layout.astro';
import Card from '../../components/Card.astro';
import { getCollection } from 'astro:content';

const courses = await getCollection('courses');
type Course = (typeof courses)[number];
const grouped = courses.reduce((acc, course) => {
  const key = course.data.status;
  (acc[key] ??= []).push(course);
  return acc;
}, {} as Record<string, Course[]>);
---

<Layout title="Courses" description="Courses for students and teachers in computer science.">
  <h1>Courses</h1>
  {Object.entries(grouped).map(([status, items]) => (
    <section>
      <h2>{status}</h2>
      <div class="grid">
        {items.map((courseItem) => (
          <Card
            title={courseItem.data.title}
            description={courseItem.data.description}
            href={withBase(courseRoute(courseItem.slug))}
            meta={`${courseItem.data.level} Â· ${courseItem.data.duration}`}
            variant="course"
          />
        ))}
      </div>
    </section>
  ))}
</Layout>
