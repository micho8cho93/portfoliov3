---
import { withBase } from '../../utils/withBase';
import { resource as resourceRoute } from '../../lib/routes';
import Layout from '../../components/Layout.astro';
import Card from '../../components/Card.astro';
import { getCollection } from 'astro:content';

const resources = await getCollection('resources');
type Resource = (typeof resources)[number];
const grouped = resources.reduce((acc, resource) => {
  const key = resource.data.type;
  (acc[key] ??= []).push(resource);
  return acc;
}, {} as Record<string, Resource[]>);
---

<Layout title="Resources" description="Free classroom-ready tools, templates, and links.">
  <h1>Resources</h1>
  <p class="measure">Download and use classroom-ready resources that support instruction, assessment, and project-based learning.</p>
  <section>
    <h2>Start here</h2>
    <ul>
      <li><a href={withBase('/teaching/lesson-plans')}>Lesson plan supports</a></li>
      <li><a href={withBase('/teaching/assessment-rubrics')}>Assessment rubric supports</a></li>
      <li><a href={withBase('/contact')}>Request a custom resource walkthrough</a></li>
    </ul>
  </section>
  {Object.entries(grouped).map(([type, items]) => (
    <section>
      <h2>{type}</h2>
      <div class="grid">
        {items.map((resourceItem) => (
          <Card
            title={resourceItem.data.title}
            description={resourceItem.data.description}
            href={withBase(resourceRoute(resourceItem.slug))}
            meta={resourceItem.data.type}
            variant="resource"
          />
        ))}
      </div>
    </section>
  ))}
  <p><a class="button" href={withBase('/contact')}>Download resources with support</a></p>
</Layout>
