---
import { withBase } from "../../utils/withBase";
import Layout from '../../components/Layout.astro';
import TagList from '../../components/TagList.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const resources = await getCollection('resources');
  return resources.map((resource) => ({ params: { slug: resource.slug }, props: { resource } }));
}

const { resource } = Astro.props;
const { Content } = await render(resource);
const resourceHref = resource.data.url ?? resource.data.file;
const resolvedResourceHref =
  resourceHref && resourceHref.startsWith("/")
    ? withBase(resourceHref)
    : resourceHref;
const buttonLabel = resource.data.url ? 'Open resource' : 'Download resource';
---

<Layout title={`${resource.data.title} | Resources`} description={resource.data.description}>
  <p><a href={withBase("/resources")}>‚Üê Back to resources</a></p>
  <article>
    <h1>{resource.data.title}</h1>
    <p>{resource.data.description}</p>
    <p class="meta">{resource.data.type}</p>
    <TagList tags={resource.data.tags ?? []} />
    <p>
      <a class="button" href={resolvedResourceHref} target={resource.data.url ? '_blank' : undefined} rel="noopener noreferrer">
        {buttonLabel}
      </a>
    </p>
    <Content />
  </article>
</Layout>
